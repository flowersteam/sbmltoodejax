
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Should you use SBMLtoODEjax? &#8212; sbmltoodejax</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
  
  <!-- So that users can add custom icons -->
  <script src="_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="_static/documentation_options.js?v=0f4711b3"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'why_use';</script>
    <link rel="canonical" href="https://developmentalsystems.org/sbmltoodejax/why_use.html" />
    <link rel="icon" href="_static/logo.svg"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Design principles" href="design_principles.html" />
    <link rel="prev" title="Installation" href="installation.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="0.4.3" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.svg" class="logo__image only-light" alt="sbmltoodejax - Home"/>
    <img src="_static/logo.svg" class="logo__image only-dark pst-js-only" alt="sbmltoodejax - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">SBMLtoODEjax</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="index.html">üè° Home</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="installation.html">üõ†Ô∏è Installation</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">üëÄ Why SBMLtoODEjax?</a></li>
<li class="toctree-l1"><a class="reference internal" href="design_principles.html">üé® Design Principles</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">ü§ù Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="jax101.html">üìé Jax 101 [external]</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">üéì Tutorials</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="tutorials/biomodels_curation.html">Numerical simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/parallel_execution.html">Parallel execution</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/benchmark.html">Benchmarking</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/gradient_descent.html">Gradient descent</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Public API - sbmltoodejax package</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="api/parse.html"><code class="docutils literal notranslate"><span class="pre">sbmltoodejax.parse</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="api/modulegeneration.html"><code class="docutils literal notranslate"><span class="pre">sbmltoodejax.modulegeneration</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="api/jaxfuncs.html"><code class="docutils literal notranslate"><span class="pre">sbmltoodejax.jaxfuncs</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="api/biomodels_api.html"><code class="docutils literal notranslate"><span class="pre">sbmltoodejax.biomodels_api</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="api/utils.html"><code class="docutils literal notranslate"><span class="pre">sbmltoodejax.utils</span></code></a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/flowersteam/sbmltoodejax" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/why_use.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Should you use SBMLtoODEjax?</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#advantages">üëç Advantages</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ease-of-use">Ease of use</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#flexibility">Flexibility</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#just-in-time-compilation">Just-in-time compilation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#automatic-vectorization">Automatic vectorization</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#automatic-differentiation">Automatic differentiation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#limitations">üëé Limitations</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#jax-can-be-hard">JAX can be hard</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#does-not-yet-handle-several-cases">Does not (yet) handle several cases</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="should-you-use-sbmltoodejax">
<h1>Should you use SBMLtoODEjax?<a class="headerlink" href="#should-you-use-sbmltoodejax" title="Link to this heading">#</a></h1>
<section id="advantages">
<h2>üëç Advantages<a class="headerlink" href="#advantages" title="Link to this heading">#</a></h2>
<section id="ease-of-use">
<h3>Ease of use<a class="headerlink" href="#ease-of-use" title="Link to this heading">#</a></h3>
<p>With only few lines of python code, SBMLtoODEjax allows you to load and simulate existing SBML files.
For instance, if one wants to reproduce simulation results from <a class="reference external" href="https://www.ebi.ac.uk/biomodels/BIOMD0000000010#Curation">this model</a>
hosted on the BioModels website, one simply needs to implement the following:</p>
<div style="display: flex; align-items: center;">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sbmltoodejax.utils</span> <span class="kn">import</span> <span class="n">load_biomodel</span>

<span class="c1"># load and simulate model </span>
<span class="n">model</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">load_biomodel</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">n_secs</span> <span class="o">=</span> <span class="mi">150</span><span class="o">*</span><span class="mi">60</span>
<span class="n">n_steps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n_secs</span> <span class="o">/</span> <span class="n">model</span><span class="o">.</span><span class="n">deltaT</span><span class="p">)</span>
<span class="n">ys</span><span class="p">,</span> <span class="n">ws</span><span class="p">,</span> <span class="n">ts</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">n_steps</span><span class="p">)</span>

<span class="c1"># plot time-course simulation</span>
<span class="o">...</span>
</pre></div>
</div>
<img src="_static/biomd_simulation.svg" width="400px">
</div>
<p>You can check our <a class="reference internal" href="tutorials/biomodels_curation.html"><span class="std std-doc">Numerical Simulation</span></a> tutorial to reproduce results yourself and see more examples.</p>
</section>
<section id="flexibility">
<h3>Flexibility<a class="headerlink" href="#flexibility" title="Link to this heading">#</a></h3>
<p>With the SBMLtoODEjax conventions and <a class="reference internal" href="design_principles.html"><span class="std std-doc">Design Principles</span></a>, one can easily manipulate the model‚Äôs variables and parameters,
whether they are species initial or dynamical states, reaction kinematic or constant parameters, or even ODE-solver hyperparameters.</p>
<p>Those parameters can not only be easily manipulated by hand but also explored with more advanced automatic techniques that are facilitated by JAX
automatic vectorization and/or differentiation (see below).</p>
</section>
<section id="just-in-time-compilation">
<h3>Just-in-time compilation<a class="headerlink" href="#just-in-time-compilation" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">jit</span></code> compilation is one of the core function transformations in JAX.
When a JIT-compiled function is called for the first time, JAX generates an optimized representation of the function called a trace such that
subsequent calls to the function use this compiled trace, resulting in improved performance.</p>
<p>JAX allows us to efficiently execute model rollouts by using the <code class="docutils literal notranslate"><span class="pre">jit</span></code> transformation over the <em>ModelStep</em> function and by using the <code class="docutils literal notranslate"><span class="pre">scan</span></code> primitive to reduce compilation time of
for-loop calling of the JIT-compiled function. Basically, the models generated by SBMLtoODEjax are implemented as below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ModelRollout</span><span class="p">(</span><span class="n">eqx</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_steps</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">w0</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">t0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>

        <span class="nd">@jit</span> <span class="c1"># use of jit transformation decorator</span>
        <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">carry</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
            <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">carry</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">modelstepfunc</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">deltaT</span><span class="p">),</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
        
        <span class="c1"># use of scan primitive to replace for loop (and reduce compilation time)</span>
        <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">t</span><span class="p">),</span> <span class="p">(</span><span class="n">ys</span><span class="p">,</span> <span class="n">ws</span><span class="p">,</span> <span class="n">ts</span><span class="p">)</span> <span class="o">=</span> <span class="n">lax</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="n">y0</span><span class="p">,</span> <span class="n">w0</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">t0</span><span class="p">),</span> <span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_steps</span><span class="p">))</span> 
        <span class="n">ys</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">ys</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ws</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">ys</span><span class="p">,</span> <span class="n">ws</span><span class="p">,</span> <span class="n">ts</span>
</pre></div>
</div>
<p>Below we compare the average simulation time of model rollouts, on the same machine and for different rollout lengths (reaction times),
for models generated with the original SBMLtoODEpy library (shown in pink) versus with the SBMLtoODEjax library (shown in blue):</p>
<img src="_static/benchmark_n_secs.svg" width="550px">
<p>We can see that for short reaction times (here &lt;100 secs with <span class="math notranslate nohighlight">\(\Delta T=0.1\)</span>, see Log Scale), SBMLtoODEjax simulation takes longer than the original SBMLtoODEpy
library because when calling <em>ModelStep</em> for the first time, it takes some time to generate the compiled trace.
However, the advantage of SBMLtoODEjax becomes clear when considering longer rollouts where we obtain huge speed-ups with respect to original SBMLtoODEpy library (see Linear Scale).
This is because the original SBMLtoODEpy python code uses for-loops, hence have linear increase of compute time, whereas the scanned JIT-compiled step function executes much faster.
You can check our <a class="reference internal" href="tutorials/benchmark.html"><span class="std std-doc">Benchmarking</span></a> tutorial for more details on the comparison.</p>
</section>
<section id="automatic-vectorization">
<h3>Automatic vectorization<a class="headerlink" href="#automatic-vectorization" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">vmap</span></code> is another core function transformations in JAX which enables efficient (and seamless) vectorization of functions.
Here, it is particularly useful for running simulation in parallel with batched computations such as batch of initial conditions.
As shown below, doing this in JAX is very simple as one simply need to use <code class="docutils literal notranslate"><span class="pre">vmap</span></code> transformation to vectorize the model function and then call the batched model in the exact same way:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># vector of initial conditions</span>
<span class="n">batched_y0</span> <span class="o">=</span> <span class="o">...</span>

<span class="c1"># batch model</span>
<span class="n">batched_model</span> <span class="o">=</span> <span class="n">vmap</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">out_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>

<span class="c1"># run simulation in batch mode</span>
<span class="n">batched_ys</span><span class="p">,</span> <span class="n">batched_ws</span><span class="p">,</span> <span class="n">ts</span> <span class="o">=</span> <span class="n">batched_model</span><span class="p">(</span><span class="n">n_steps</span><span class="p">,</span> <span class="n">batched_y0</span><span class="p">)</span>
</pre></div>
</div>
<p>Below we compare the average simulation time of model rollouts for 1) the SBMLtoODEpy-generated models and for loop computations over the inputs (pink), 2) the SBMLtoODEpy-generated models and pooling over the inputs (orange)
and 3) the SBMLtoODEjax library with vectorized computations (blue). We show results for different batch sizes (x-axis), where all runs have been done on the same machine and for
a rollout length of 10 seconds with <span class="math notranslate nohighlight">\(\Delta T=0.1\)</span>.</p>
<img src="_static/benchmark_n_in_parallel.svg" width="550px">
<p>Again, similar conclusions can be drawn where SBMLtoODEjax is less efficient for small batch sizes (and small rollout lengths), but becomes very advantageous
for larger batch sizes.
You can check our <a class="reference internal" href="tutorials/benchmark.html"><span class="std std-doc">Benchmarking</span></a> tutorial for more details on the comparison.</p>
</section>
<section id="automatic-differentiation">
<h3>Automatic differentiation<a class="headerlink" href="#automatic-differentiation" title="Link to this heading">#</a></h3>
<p>Finally, <code class="docutils literal notranslate"><span class="pre">grad</span></code> is another core function transformations in JAX which enables automatic differentiation
and allows seamless integration of SBMLtoODEjax models with <a class="reference external" href="https://optax.readthedocs.io/en/latest/">Optax</a> pipelines, a gradient processing and optimization library for JAX.
Whereas Optax has typically been used to optimize parameters of neural networks, we can use it in the very same way to optimize parameters of our SBMLtoODEjax models
as shown below:</p>
<div style="display: flex; align-items: center;">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load Model</span>
<span class="n">model</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">w0</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">load_model</span><span class="p">(</span><span class="n">model_idx</span><span class="p">)</span>

<span class="c1"># Optax pipeline</span>
<span class="nd">@jit</span>
<span class="k">def</span> <span class="nf">loss_fn</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;loss function&quot;&quot;&quot;</span>
    <span class="n">ys</span><span class="p">,</span> <span class="n">ws</span><span class="p">,</span> <span class="n">ts</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">n_steps</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">w0</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
    <span class="n">loss</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">ys</span><span class="p">[</span><span class="n">y_indexes</span><span class="p">[</span><span class="s2">&quot;Ca_Cyt&quot;</span><span class="p">]]</span>
                               <span class="o">-</span><span class="n">target_Ca_Cyt</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">loss</span>

<span class="nd">@jit</span>
<span class="k">def</span> <span class="nf">make_step</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">opt_state</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;update function&quot;&quot;&quot;</span>
    <span class="n">loss</span><span class="p">,</span> <span class="n">grads</span> <span class="o">=</span> <span class="n">value_and_grad</span><span class="p">(</span><span class="n">loss_fn</span><span class="p">)(</span><span class="n">c</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
    <span class="n">updates</span><span class="p">,</span> <span class="n">opt_state</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">grads</span><span class="p">,</span> <span class="n">opt_state</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">optax</span><span class="o">.</span><span class="n">apply_updates</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">updates</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">loss</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">opt_state</span>

<span class="n">n_optim_steps</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">optim</span> <span class="o">=</span> <span class="n">optax</span><span class="o">.</span><span class="n">adam</span><span class="p">(</span><span class="mf">1e-3</span><span class="p">)</span>
<span class="n">opt_state</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="n">train_loss</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">optim_step_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_optim_steps</span><span class="p">):</span>
    <span class="n">loss</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">opt_state</span> <span class="o">=</span> <span class="n">make_step</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">opt_state</span><span class="p">)</span>
    <span class="n">train_loss</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss</span><span class="p">)</span>

<span class="c1"># Plot train loss</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">train_loss</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;training loss&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;train steps&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div style="display: flex; flex-direction: column;" width="250px">
<img src="_static/sgd_c0.svg">
<img src="_static/sgd_c1.svg">
<img src="_static/sgd_c2.svg">
</div>
</div>
<p>In the above example, we show how we can use optax pipeline to optimize the kinematic parameters of the <a class="reference external" href="https://www.ebi.ac.uk/biomodels/BIOMD0000000145">biomodel #145</a> to have it follows a target pattern
of calcium ions oscillations. We show the resulting behavior before and after optimization, and see that optimization successfully found parameters <span class="math notranslate nohighlight">\(c\)</span> leading to calcium oscillations
close to target patterns (while not perfectly matching).
Please check our <a class="reference internal" href="tutorials/gradient_descent.html"><span class="std std-doc">Gradient Descent</span></a> tutorial for walkthrough of the optimization procedure, as well as more-advanced interventions by optimizing
temporally regulated patterns of stimuli on specific nodes (instead of modifying the network weights).</p>
<p>To our knowledge, this is the first software tool that allows to perform automatic differentiation
and gradient-descent based optimization of SBML models parameters and/or dynamical states.
However, as detailed in the tutorial, gradient descent can also be quite hard in the considered biological systems and other optimization methods (like evolutionary algorithms)
might be more adapted.</p>
</section>
</section>
<section id="limitations">
<h2>üëé Limitations<a class="headerlink" href="#limitations" title="Link to this heading">#</a></h2>
<section id="jax-can-be-hard">
<h3>JAX can be hard<a class="headerlink" href="#jax-can-be-hard" title="Link to this heading">#</a></h3>
<p>For people that are new to JAX and/or to the functional programming style, understanding the design choices made in SBMLtoODEjax can (maybe) get quite confusing.</p>
<p>Whereas there is no need of deep understanding of the underlying principles for basic usages of the SBMLtoODEjax library such as
<a class="reference internal" href="tutorials/biomodels_curation.html"><span class="std std-doc">Numerical Simulation</span></a> and <a class="reference internal" href="tutorials/parallel_execution.html"><span class="std std-doc">Parallel Execution</span></a>, things can get more complicated
for more advanced usages such as <a class="reference internal" href="tutorials/gradient_descent.html"><span class="std std-doc">Gradient-descent optimization</span></a> and custom interventions on the biological model
structure and/or dynamics.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>For people that are not familiar with JAX but that want to give it a try, the main constraints of programming in JAX
are well-summarized in their documentation <a class="reference external" href="https://jax.readthedocs.io/en/latest/notebooks/Common_Gotchas_in_JAX.html">üî™ JAX - The Sharp Bits üî™</a>.
Be sure to check it before starting to write your code in JAX, as they are the main things that can make your programming and/or debugging experience harder.</p>
</div>
</section>
<section id="does-not-yet-handle-several-cases">
<h3>Does not (yet) handle several cases<a class="headerlink" href="#does-not-yet-handle-several-cases" title="Link to this heading">#</a></h3>
<p>SBMLtoODEjax is still in its early phase so they are several limitations to it at the moment.
In particular, they are several error cases that are not handled by the current simulator including:</p>
<ul class="simple">
<li><p>Events: SBML files with events (discrete occurrences that can trigger discontinuous changes in the model) are not handled</p></li>
<li><p>Custom Functions: we handle a large portion of functions possibly-used in SBML files (see <code class="docutils literal notranslate"><span class="pre">mathFuncs</span></code> in <code class="docutils literal notranslate"><span class="pre">sbmltoodejax.modulegeneration.GenerateModel</span></code>), but not all</p></li>
<li><p>Custom solvers: To integrate the model‚Äôs equation, we use jax experimental <code class="docutils literal notranslate"><span class="pre">odeint</span></code> solver but do not yet allow for other solvers.</p></li>
<li><p>NaN/Negative values: numerical simulation sometimes leads to NaN values (or negative values for the species amounts) which could either be due to wrong parsing or solver issues</p></li>
</ul>
<p>This means that a large portion of the possible SBML files cannot yet be simulated, for instance as we detail on the below image, out of 1048
curated models that one can load from the BioModels website, only 232 can successfully be simulated (given the default initial conditions) in SBMLtoODEjax.
<img src="_static/error_cases.png" width="450px"></p>
<p>üëâ Those limitations should be resolvable and will hopefully be fixed in future versions.
Please consider contributing and check our <a class="reference internal" href="contributing.html"><span class="std std-doc">Contribution Guidelines</span></a> to do so!</p>
</section>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="installation.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Installation</p>
      </div>
    </a>
    <a class="right-next"
       href="design_principles.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Design principles</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#advantages">üëç Advantages</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ease-of-use">Ease of use</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#flexibility">Flexibility</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#just-in-time-compilation">Just-in-time compilation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#automatic-vectorization">Automatic vectorization</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#automatic-differentiation">Automatic differentiation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#limitations">üëé Limitations</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#jax-can-be-hard">JAX can be hard</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#does-not-yet-handle-several-cases">Does not (yet) handle several cases</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Mayalen Etcheverry
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      ¬© Copyright 2023, Mayalen Etcheverry.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>